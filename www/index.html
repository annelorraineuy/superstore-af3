<!DOCTYPE html>
<html><!--after broke links, Superstore AF-->

<head>
<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta http-equiv="Pragma" content="no-cache">
<link href="css/style.css" rel="stylesheet" type="text/css">
<script type="text/javascript" charset="utf-8" src="intelxdk.js"></script>
<script src="js/appframework.ui.min.js"></script>
<script type="text/javascript" language="javascript">
    var isIntel=window.intel&&window.intel.xdk
    // This event handler is fired once the intel libraries are ready
    function onDeviceReady() {
        //hide splash screen now that our app is ready to run
        intel.xdk.device.hideSplashScreen();
        setTimeout(function () {
            $.ui.launch();
        }, 50);
		
		//lock in "portrait" orientation 
		intel.xdk.device.setRotateOrientation("portrait");
    }
    //initial event handler to detect when intel is ready to roll
    document.addEventListener("intel.xdk.device.ready", onDeviceReady, false);
	
	//database stuff
	var db = createTables();
	var query;
	var onItemID = null; 

	$(document).ready(function(e) {
        $("#addItem").bind("click", function() {
			console.log("Got Task");
			insertItem();
		});
		
		/*
		Find out what is clicked
		$("body").click(function(event) {
			alert(event.target.id+" and "+event.target.className);	
		});*/
		
		$("#searchResults-ul").on("click", "a", function (e) {
    		e.preventDefault();
    		onItemID = $(this).closest("li").attr("id");
		});
		
    });
	
	//start webSQL
	function getOpenDb() { 
		try {
			if (window.openDatabase) {                    
				return window.openDatabase;                  
			} else {
				alert('No HTML5 support');
				return undefined;
			}
		}
		catch (e) {
			alert(e);
			return undefined;
		}            
	}
	
	function createTables() {
		var openDB = getOpenDb();
		
		if(!openDB)
		{                
			return; 
			alert("Error: failed to create database.");              
		}
		else
		{
			
			console.log("going to create table category");
			db = openDB("superstore_dbc","1.0","Superstore Client Database", 2*1024*1024);
			
			db.transaction(function (t) {
				$.ajax({
						type:"GET",
						async: false,
						url:"data/websql-queries.txt",
						success:function(data){
								query = data.split("\n"); //read the sql queries from text file line by line
								
								for(var i=0; i < query.length; i++)
									t.executeSql(query[i], [], null, databaseError);     
							}
					});
				});
			
			 selRows();
			return db;
    	}            
	}
	
	function successQuery() {
		alert("successfully created table!");	
	}
	
	function databaseError(err) {
		alert("Error: "+err);
	}
	
	function readItems() {
		console.log("Entering readItems()");
		db.transaction(function(t) {
			t.executeSql('SELECT * from items', [], selRows, databaseError);	
		}, databaseError);
		console.log("leaving readItems()");
	}
	
	function insertItem() {
		 if(!db)
		{                
			return;                
		}
		var itemName = document.getElementById("itemName").value;
		var itemPrice = document.getElementById("itemPrice").value;
		var brand = document.getElementById("brand").value;
		var manufacturer = document.getElementById("manufacturer").value;
		var quantity = document.getElementById("quantity").value;
		var itemPic = document.getElementById("itemPicURL").value;
	
		db.transaction(function (t) { 
			t.executeSql("INSERT INTO items('item_name','brand','manufacturer','quantity','price','pic_url') values('" + itemName + "', '" + brand + "', '" + manufacturer + "', '" + quantity + "', '" + itemPrice + "', '" + itemPic + "');", [], selRows, databaseError);
			alert("Row Inserted!");
			selRows();
		});	
	}

	
	function selRows() {
    
    var q = "SELECT * FROM items, product WHERE items.prod_ID = product.prod_ID";
    
    db.readTransaction(function (t) {
        t.executeSql(q, null, function (t, data) {
    		var html = "";
            for (var i = 0; i < data.rows.length; i++) {
                  html += "<li class='resultsItem upper' id='"+data.rows.item(i).item_ID+"'><a href='#item-page' class='itemLink'><img src='"+ data.rows.item(i).pic_url + "' class='item_thumb' /><div class='itemPrice'>$"+data.rows.item(i).price +"</div><div class='itemBrand'>" +data.rows.item(i).brand + "</div><div class='nameItem'>" +data.rows.item(i).item_name + "</div><div class='locationDiv'><img src='images/location_icon.svg' class='location_svg' />Aisle "+data.rows.item(i).aisle_ID+" SHELF "+data.rows.item(i).shelf_ID+"</div></a></li>";
			}
            var searchResultsList= document.getElementById("searchResults-ul");
            searchResultsList.innerHTML = html;
        });
    });
	}
	
	function selItem()
	{
		if (onItemID != null)
		{
			var q = "SELECT * FROM items, product, category WHERE items.item_ID=? AND items.prod_ID = product.prod_ID AND product.cat_ID = category.cat_ID";
			db.transaction(function(t) {
				t.executeSql(q, [onItemID], function(t, data) {
					var imageUrl, aisle, shelf, itemName, brandName, price, qty, category;
					
					//get all variables
					imageUrl = data.rows.item(0).pic_url;
					itemName = data.rows.item(0).item_name;
					aisle = data.rows.item(0).aisle_ID;
					shelf = data.rows.item(0).shelf_ID;
					brandName = data.rows.item(0).brand;
					price = data.rows.item(0).price;
					qty = data.rows.item(0).quantity;
					category = data.rows.item(0).cat_name;
					
					//format html
					var formatHtml= "<img src='"+imageUrl+"' class='bigItemPic'><div class='bigItemBrand textCenter upper'>"+brandName+"</div><div class='bigItemName textCenter upper'>"+itemName+"</div><a href='#dedicated-map'><div class='bigLocationDiv'><img src='images/location_ico_bigger.svg' class='bigLocation'>AISLE "+aisle+" SHELF "+shelf+"</div></a><div class='itemDetails'><img src='images/money_icon.svg'>$"+price+"<br><img src='images/weigh_icon.svg'>"+qty+"<br><img src='images/description_icon.svg'>"+category+"</div>";
					
					$(".itemWrapper").html(formatHtml);
				}, function (error) { //on error 
					$(".itemWrapper").html("<br><h2>Sorry for the inconvenience</h2><p>There was an error that occured. Please contact support.</p><br><p> Error: "+error+"</p>");
					});	
			});
		}
	}
</script>
<script>
    if(isIntel)
        $.ui.autoLaunch = false;
    $.ui.useOSThemes = true; //Change this to false to force a device theme
    $.ui.blockPageScroll();
    $(document).ready(function () {
        if ($.ui.useOSThemes && (!$.os.ios||$.os.ios7))
            $("#afui").removeClass("ios");
    });
</script>
<link href="css/icons.css" rel="stylesheet" type="text/css">
<link href="css/af.ui.css" rel="stylesheet" type="text/css">
</head>
<body>
<div id="afui" class="ios">
    <div id="header" class="header"></div>
    <div id="content" style="">
        <div class="panel" title="" id="main" selected="selected" style="" data-appbuilder-object="page" data-header="none" data-footer="footer">
            <input type="search" id="searchFieldDiv" class="searchFieldDiv" name="searchFieldDiv"
            placeholder="Where can I find...?"><a class="button" href="#search-results" data-appbuilder-object="button"
            data-transition="slide" id="search-button">Search</a>
            <!--<a class="button" href="#add-item" style="" data-appbuilder-object="button" data-transition="slide"
            id="add-item-button">Add Item</a>-->
        </div>
        <div class="panel" title="search results" data-nav="nav_0" id="search-results" data-appbuilder-object="page" style="" data-header="header_no_backbutton" data-footer="footer">
            <div id="searchBarDiv">
                <input type="search" id="searchFieldDiv" class="searchFieldDiv" name="searchFieldDiv" placeholder="Where can I find...?">
            </div>
            <ul class="list" id="searchResults-ul" data-appbuilder-object="list"></ul>
            <!-- /search list UL -->
        </div>
        <div class="panel" title="Add-Item" data-nav="sideMenu" id="add-item" data-appbuilder-object="page"
        style="">
            <label>Item Name:</label>
            <input type="text" id="itemName">
            <br>
            <label>Brand:</label>
            <input type="text" id="brand">
            <br>
            <label>Manufacturer:</label>
            <input type="text" id="manufacturer">
            <br>
            <label>Quantity:</label>
            <input type="text" id="quantity">
            <br>
            <label>Price:</label>
            <input type="text" id="itemPrice">
            <br>
            <label>Picture:</label>
            <input type="text" id="itemPicURL">
            <button id="addItem" data-appbuilder-object="button" class="">Add Item</button>
        </div>
        <!-- /add item-->
        <div class="panel" title="Item Page" data-nav="sideMenu" data-load="selItem" id="item-page" data-appbuilder-object="page"
        style="" data-header="header_backbutton" data-footer="none">
		<div class="itemWrapper"></div>
        </div>
        <!-- /item page -->
        <div class="panel" title="Map" data-nav="sideMenu" id="map" data-appbuilder-object="page"
        style="" data-header="default" data-footer="none" data-modal="true"><img src="images/map-all.svg" class="map"></div>
        <!-- /common map -->
        <div class="panel" title="Map" data-nav="sideMenu" id="dedicated-map" data-appbuilder-object="page"
        style="" data-header="default" data-footer="none" data-modal="true"><img src="images/map-all.svg" class="map"></div>
        <!-- dedicated map-->
    </div>
    <!-- /content -->

    <div id="navbar" class="footer">
        <footer></footer>
    </div>

    <nav id="sideMenu" data-appbuilder-object="nav">
        <h1>Side Menu</h1>
    </nav>
    <footer id="footer" data-appbuilder-object="footer"><a href="#map" class="icon location">Map</a>
    </footer>
    <header id="header_backbutton" data-appbuilder-object="header"><a id="backButton" class="button backButton">Back</a>
        <h1 class="">Item Details</h1>
    </header>
    <header id="header_no_backbutton" data-appbuilder-object="header">
        <h1 class="">Search Results</h1>
    </header>

</div>
</body>





</html>